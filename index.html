<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Hello World!</title>
    </head>
    <body>
        <h1>Connecting to MySQL</h1>
        <br>
        <input type="button" id="action-btn" value="Retrieve 10 first rows in the database" />
        <table id="table" border="1">
            <tbody>
                
            </tbody>
        </table>
    </body>
    <script>

        function el(selector) {
            return document.getElementById(selector);
        }

        el('action-btn').addEventListener('click', () => {
            // Get the mysql service
            getFirstTenRows((rows) => {
                var html = '';

                rows.forEach((row) => {
                    html += '<tr>';
                    html += '<td>';
                    html += row.id;
                    html += '</td>';
                    html += '<td>';
                    html += row.contrato_id;
                    html += '</td>';
                    html += '<td>';
                    html += row.data_agendamento;
                    html += '</td>';
                    html += '<td>';
                    html += row.hora_agendamento;
                    html += '</td>';
                    html += '<td>';
                    html += row.usuario_id;
                    html += '</td>';
                    html += '<td>';
                    html += row.agendamento_status;
                    html += '</td>';
                    html += '</tr>';
                    console.log(row);
                });

                document.querySelector('#table > tbody').innerHTML = html;
            });
        },false);

        function getFirstTenRows(callback){
            const mysql = require('mysql');

            // Add the credentials to access your database
            let connection = mysql.createConnection({
                host     : 'localhost',
                user     : 'root',
                password : null,
                database : 'arko_db_v2'
            });

            // connect to mysql
            connection.connect((err) => {
                // in case of error
                if(err){
                    console.log(err.code);
                    console.log(err.fatal);
                }
            });

            // Perform a query
            let query = 'SELECT id, contrato_id, data_agendamento, hora_agendamento, usuario_id, agendamento_status FROM agendamento LIMIT 10';

            connection.query(query, (err, rows, fields) => {
                if(err){
                    console.log("An error ocurred performing the query.");
                    console.log(err);
                    return;
                }

                callback(rows);

                console.log("Query succesfully executed");
            });

            // Close the connection
            connection.end( () => {
                // The connection has been closed
            });
        }
    </script>
</html>
